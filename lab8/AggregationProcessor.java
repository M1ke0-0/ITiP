package lab8;

import java.util.List;

/**
 * AggregationProcessor - —ç—Ç–æ –∫–ª–∞—Å—Å –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è, –ø–æ–¥—Å—á–µ—Ç–∞) –¥–∞–Ω–Ω—ã—Ö
 *
 * –ü—Ä–µ–¥—Å—Ç–∞–≤—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
 * - –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É
 * - –ù–∞—Ö–æ–¥–∏–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
 * - –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
 *
 * –ó–¥–µ—Å—å –º—ã –ù–ï –∏–∑–º–µ–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ, –∞ –ê–ù–ê–õ–ò–ó–ò–†–£–ï–ú –∏—Ö –∏ –≤—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
 */
public class AggregationProcessor {

    /**
     * –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª—é–¥–µ–π –∏ –≤—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
     *
     * –≠—Ç–æ –∫–∞–∫ –ø–µ—Ä–µ–ø–∏—Å—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è:
     * - –°—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —á–µ–ª–æ–≤–µ–∫
     * - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
     *
     * –í–ê–ñ–ù–û: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç —Å–ø–∏—Å–æ–∫, –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
     */
    @DataProcessor(description = "–ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞", priority = 20)
    public List<Person> countPeople(List<Person> people) {
        long count = people.stream().count();
        System.out.println("üë• –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –≤—Å–µ–≥–æ –ª—é–¥–µ–π –≤ —Å–ø–∏—Å–∫–µ = " + count);

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ—Ç –∂–µ —Å–ø–∏—Å–æ–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        return people;
    }

    /**
     * –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π –∑–∞—Ä–ø–ª–∞—Ç—ã
     *
     * –≠—Ç–æ –∫–∞–∫ –ø–æ–¥—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∞–ª–ª–∞ –≤ –∫–ª–∞—Å—Å–µ:
     * - –°–∫–ª–∞–¥—ã–≤–∞–µ–º –≤—Å–µ –∑–∞—Ä–ø–ª–∞—Ç—ã
     * - –î–µ–ª–∏–º –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π
     * - –ü–æ–ª—É—á–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
     *
     * –ü—Ä–∏–º–µ—Ä: –∑–∞—Ä–ø–ª–∞—Ç—ã 40000, 50000, 60000
     * –°—Ä–µ–¥–Ω–µ–µ = (40000 + 50000 + 60000) / 3 = 50000
     */
    @DataProcessor(description = "–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π –∑–∞—Ä–ø–ª–∞—Ç—ã", priority = 15)
    public List<Person> calculateAverageSalary(List<Person> people) {
        // mapToDouble - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ –µ–≥–æ –∑–∞—Ä–ø–ª–∞—Ç—É (—á–∏—Å–ª–æ)
        // average() - –≤—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        // orElse(0.0) - –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π, –≤–µ—Ä–Ω—É—Ç—å 0
        double averageSalary = people.stream()
                .mapToDouble(Person::getSalary)
                .average()
                .orElse(0.0);

        System.out.printf("üíµ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ = %.2f%n", averageSalary);

        return people;
    }

    /**
     * –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞
     *
     * –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—Ä–µ–¥–Ω–µ–π –∑–∞—Ä–ø–ª–∞—Ç–µ, –Ω–æ –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–∞
     */
    @DataProcessor(description = "–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞", priority = 10)
    public List<Person> calculateAverageAge(List<Person> people) {
        double averageAge = people.stream()
                .mapToInt(Person::getAge)
                .average()
                .orElse(0.0);

        System.out.printf("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç = %.2f%n", averageAge);

        return people;
    }

    /**
     * –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞—Ä–ø–ª–∞—Ç—ã
     *
     * –≠—Ç–æ –∫–∞–∫ –ø–æ–∏—Å–∫ —Å–∞–º–æ–≥–æ –±–æ–≥–∞—Ç–æ–≥–æ –∏ —Å–∞–º–æ–≥–æ –±–µ–¥–Ω–æ–≥–æ:
     * - –ò—â–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∑–∞—Ä–ø–ª–∞—Ç—É
     * - –ò—â–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∑–∞—Ä–ø–ª–∞—Ç—É
     * - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –Ω–∏–º–∏
     */
    @DataProcessor(description = "–ü–æ–∏—Å–∫ min/max –∑–∞—Ä–ø–ª–∞—Ç—ã", priority = 5)
    public List<Person> findMinMaxSalary(List<Person> people) {
        if (people.isEmpty()) {
            System.out.println("‚ö†Ô∏è  –°–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π, –Ω–µ—á–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å");
            return people;
        }

        // max() –∏ min() –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç Optional (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
        // orElse() - —á—Ç–æ –≤–µ—Ä–Ω—É—Ç—å, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ—Ç
        double maxSalary = people.stream()
                .mapToDouble(Person::getSalary)
                .max()
                .orElse(0.0);

        double minSalary = people.stream()
                .mapToDouble(Person::getSalary)
                .min()
                .orElse(0.0);

        System.out.printf("üí∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ = %.2f, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è = %.2f%n",
                        maxSalary, minSalary);

        return people;
    }
}
