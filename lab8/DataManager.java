package lab8;

import java.io.*;
import java.lang.reflect.Method;
import java.util.*;
import java.util.concurrent.*;

/**
 * DataManager - —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å-–º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
 *
 * –ü—Ä–µ–¥—Å—Ç–∞–≤—å —ç—Ç–æ –∫–∞–∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—Å–∫–∞—è –≤—ã—à–∫–∞ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞:
 * - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–∞–º–æ–ª–µ—Ç—ã (–¥–∞–Ω–Ω—ã–µ)
 * - –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫—É (–≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã)
 * - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
 *
 * –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
 */
public class DataManager {

    // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    // –≠—Ç–æ –∫–∞–∫ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π
    private List<Object> processors = new ArrayList<>();

    // –î–∞–Ω–Ω—ã–µ, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º (—Å–ø–∏—Å–æ–∫ –ª—é–¥–µ–π)
    // –≠—Ç–æ –∫–∞–∫ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, —Å –∫–æ—Ç–æ—Ä–æ–π –º—ã —Ä–∞–±–æ—Ç–∞–µ–º
    private List<Person> data = new ArrayList<>();

    // –ü—É–ª –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
    // –≠—Ç–æ –∫–∞–∫ –±—Ä–∏–≥–∞–¥–∞ —Ä–∞–±–æ—á–∏—Ö: –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ
    // newFixedThreadPool(4) = —Å–æ–∑–¥–∞–µ–º –±—Ä–∏–≥–∞–¥—É –∏–∑ 4 —Ä–∞–±–æ—á–∏—Ö
    private ExecutorService executorService = Executors.newFixedThreadPool(4);

    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
     *
     * –≠—Ç–æ –∫–∞–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤ –º–∞—Å—Ç–µ—Ä—Å–∫—É—é:
     * - –ü—Ä–∏–Ω–æ—Å–∏–º –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (processor)
     * - –ö–ª–∞–¥–µ–º –µ–≥–æ –Ω–∞ –ø–æ–ª–∫—É (–¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ processors)
     * - –¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö
     */
    public void registerDataProcessor(Object processor) {
        processors.add(processor);
        System.out.println("–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫: " + processor.getClass().getSimpleName());
    }

    /**
     * –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
     *
     * –≠—Ç–æ –∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å Excel-—Ñ–∞–π–ª –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –ª—é–¥—å–º–∏:
     * - –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª
     * - –ß–∏—Ç–∞–µ–º —Å—Ç—Ä–æ—á–∫—É –∑–∞ —Å—Ç—Ä–æ—á–∫–æ–π
     * - –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ (—Ñ–æ—Ä–º–∞—Ç: –ò–º—è,–í–æ–∑—Ä–∞—Å—Ç,–ó–∞—Ä–ø–ª–∞—Ç–∞)
     * - –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Person –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—à —Å–ø–∏—Å–æ–∫
     *
     * –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–π–ª–µ: "–ò–≤–∞–Ω,25,50000.0"
     */
    public void loadData(String source) {
        System.out.println(" –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞: " + source);
        data.clear(); // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

        try (BufferedReader reader = new BufferedReader(new FileReader(source))) {
            String line;

            // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
            while ((line = reader.readLine()) != null) {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                if (line.trim().isEmpty() || line.startsWith("#")) {
                    continue;
                }

                // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ –∑–∞–ø—è—Ç–æ–π: "–ò–≤–∞–Ω,25,50000" -> ["–ò–≤–∞–Ω", "25", "50000"]
                String[] parts = line.split(",");

                if (parts.length == 3) {
                    String name = parts[0].trim();
                    int age = Integer.parseInt(parts[1].trim());
                    double salary = Double.parseDouble(parts[2].trim());

                    data.add(new Person(name, age, salary));
                }
            }

            System.out.println(" –ó–∞–≥—Ä—É–∂–µ–Ω–æ " + data.size() + " –∑–∞–ø–∏—Å–µ–π");

        } catch (IOException e) {
            System.err.println(" –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö: " + e.getMessage());
        }
    }

    /**
     * –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
     *
     * –≠—Ç–æ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –º–µ—Ç–æ–¥! –ü—Ä–µ–¥—Å—Ç–∞–≤—å –∫–æ–Ω–≤–µ–π–µ—Ä –Ω–∞ –∑–∞–≤–æ–¥–µ:
     *
     * 1. –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π @DataProcessor –∏–∑ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
     * 2. –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–∫—Ç–æ –ø–µ—Ä–≤—ã–π, –∫—Ç–æ –≤—Ç–æ—Ä–æ–π)
     * 3. –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ)
     * 4. –ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
     *
     * –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º Reflection API - —ç—Ç–æ –∫–∞–∫ —Ä–µ–Ω—Ç–≥–µ–Ω –¥–ª—è –∫–ª–∞—Å—Å–æ–≤,
     * –ø–æ–∑–≤–æ–ª—è–µ—Ç "–∑–∞–≥–ª—è–Ω—É—Ç—å –≤–Ω—É—Ç—Ä—å" –∫–ª–∞—Å—Å–∞ –∏ –Ω–∞–π—Ç–∏ –≤—Å–µ –º–µ—Ç–æ–¥—ã —Å –Ω—É–∂–Ω–æ–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π
     */
    public void processData() {
        System.out.println("  –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö...\n");

        // –®–∞–≥ 1: –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π @DataProcessor
        List<MethodWithPriority> annotatedMethods = new ArrayList<>();

        // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
        for (Object processor : processors) {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ (—ç—Ç–æ –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞ –ø—É–ª—å—Ç–µ)
            Method[] methods = processor.getClass().getDeclaredMethods();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥
            for (Method method : methods) {
                // –ï—Å–ª–∏ –º–µ—Ç–æ–¥ –ø–æ–º–µ—á–µ–Ω –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π @DataProcessor
                if (method.isAnnotationPresent(DataProcessor.class)) {
                    DataProcessor annotation = method.getAnnotation(DataProcessor.class);

                    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –≤ —Å–ø–∏—Å–æ–∫ –≤–º–µ—Å—Ç–µ —Å –µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
                    annotatedMethods.add(new MethodWithPriority(
                        method,
                        processor,
                        annotation.priority(),
                        annotation.description()
                    ));
                }
            }
        }

        // –®–∞–≥ 2: –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ—Ç–æ–¥—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É)
        // –≠—Ç–æ –∫–∞–∫ –≤—ã—Å—Ç—Ä–æ–∏—Ç—å –ª—é–¥–µ–π –≤ –æ—á–µ—Ä–µ–¥—å –ø–æ –Ω–æ–º–µ—Ä–∞–º –±–∏–ª–µ—Ç–æ–≤
        annotatedMethods.sort((a, b) -> Integer.compare(b.priority, a.priority));

        System.out.println("üìã –ù–∞–π–¥–µ–Ω–æ " + annotatedMethods.size() + " –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤\n");

        // –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
        // (–º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ —Ç–æ–≥–¥–∞ –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω)
        for (MethodWithPriority methodInfo : annotatedMethods) {
            try {
                System.out.println("‚ñ∂Ô∏è  –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç " + methodInfo.priority + ": " +
                                 methodInfo.description);

                // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ –∏ –ø–µ—Ä–µ–¥–∞–µ–º –µ–º—É —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                // –≠—Ç–æ –∫–∞–∫ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∞ –ø—É–ª—å—Ç–µ: –º–µ—Ç–æ–¥ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
                @SuppressWarnings("unchecked")
                List<Person> result = (List<Person>) methodInfo.method.invoke(
                    methodInfo.processor,
                    data
                );

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–∞
                data = result;

                System.out.println("   –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–µ–π: " + data.size() + "\n");

            } catch (Exception e) {
                System.err.println("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞: " + e.getMessage());
                e.printStackTrace();
            }
        }

        System.out.println("‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n");
    }

    /**
     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª
     *
     * –≠—Ç–æ –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É Excel –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –¥–∏—Å–∫:
     * - –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å–∏
     * - –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É
     * - –§–æ—Ä–º–∞—Ç: –ò–º—è,–í–æ–∑—Ä–∞—Å—Ç,–ó–∞—Ä–ø–ª–∞—Ç–∞
     * - –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª
     */
    public void saveData(String destination) {
        System.out.println(" –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª: " + destination);

        try (BufferedWriter writer = new BufferedWriter(new FileWriter(destination))) {
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            writer.write("# –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n");
            writer.write("# –§–æ—Ä–º–∞—Ç: –ò–º—è,–í–æ–∑—Ä–∞—Å—Ç,–ó–∞—Ä–ø–ª–∞—Ç–∞\n");

            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
            for (Person person : data) {
                String line = String.format("%s,%d,%.2f%n",
                    person.getName(),
                    person.getAge(),
                    person.getSalary()
                );
                writer.write(line);
            }

            System.out.println(" –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ " + data.size() + " –∑–∞–ø–∏—Å–µ–π");

        } catch (IOException e) {
            System.err.println(" –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: " + e.getMessage());
        }
    }

    /**
     * –í—ã–≤–æ–¥ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —ç–∫—Ä–∞–Ω
     *
     * –≠—Ç–æ –∫–∞–∫ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞ –ø—Ä–∏–Ω—Ç–µ—Ä–µ - –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –µ—Å—Ç—å
     */
    public void printData() {
        System.out.println("\n –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ (" + data.size() + " –∑–∞–ø–∏—Å–µ–π):");
        System.out.println("‚îÄ".repeat(60));

        if (data.isEmpty()) {
            System.out.println("  (–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö)");
        } else {
            data.forEach(person -> System.out.println("  " + person));
        }

        System.out.println("‚îÄ".repeat(60) + "\n");
    }

    /**
     * –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞
     *
     * –≠—Ç–æ –∫–∞–∫ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è:
     * - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ—Ö —Ä–∞–±–æ—á–∏—Ö –¥–æ–º–æ–π (shutdown)
     * - –ñ–¥–µ–º –ø–æ–∫–∞ –æ–Ω–∏ –¥–æ–¥–µ–ª–∞—é—Ç —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—Ç—É
     * - –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥–≤–µ—Ä–∏
     */
    public void shutdown() {
        executorService.shutdown();
        try {
            // –ñ–¥–µ–º –º–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ –≤—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è
            if (!executorService.awaitTermination(60, TimeUnit.SECONDS)) {
                // –ï—Å–ª–∏ –Ω–µ –¥–æ–∂–¥–∞–ª–∏—Å—å - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
                executorService.shutdownNow();
            }
        } catch (InterruptedException e) {
            executorService.shutdownNow();
        }
    }

    /**
     * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ç–æ–¥–µ –∏ –µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ
     *
     * –≠—Ç–æ –∫–∞–∫ –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:
     * - –°–∞–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (method)
     * - –ö–æ–º—É –æ–Ω –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç (processor)
     * - –ù–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω –≤–∞–∂–µ–Ω (priority)
     * - –ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç (description)
     */
    private static class MethodWithPriority {
        Method method;
        Object processor;
        int priority;
        String description;

        MethodWithPriority(Method method, Object processor, int priority, String description) {
            this.method = method;
            this.processor = processor;
            this.priority = priority;
            this.description = description;
        }
    }
}
